<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.9.1"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>btx: rawimagetimetool.RawImageTimeTool Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">btx
   </div>
   <div id="projectbrief">Framework for SFX data analysis at LCLS.</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.1 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search','.html');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespacerawimagetimetool.html">rawimagetimetool</a></li><li class="navelem"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html">RawImageTimeTool</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="#pri-attribs">Private Attributes</a> &#124;
<a href="classrawimagetimetool_1_1RawImageTimeTool-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">rawimagetimetool.RawImageTimeTool Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Class to reimplement time tool analysis at LCLS from raw images.  
 <a href="classrawimagetimetool_1_1RawImageTimeTool.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a2c0ba4720efa91c52e10d2f72d46ebad"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a2c0ba4720efa91c52e10d2f72d46ebad">__init__</a> (self, str <a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a49603b6ebcdc44e4539f0b9dbb0a997a">expmt</a>, str <a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#ace0a81b83a66315ffd591d72261ef13e">savedir</a>, bool <a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a93d44077c3f312359208fff0d00ec993">debug</a>=False)</td></tr>
<tr class="memdesc:a2c0ba4720efa91c52e10d2f72d46ebad"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initializer for the time tool analysis object.  <a href="classrawimagetimetool_1_1RawImageTimeTool.html#a2c0ba4720efa91c52e10d2f72d46ebad">More...</a><br /></td></tr>
<tr class="separator:a2c0ba4720efa91c52e10d2f72d46ebad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a74e54dd7e6bea0d63cdd8ac8bfe6178d"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a74e54dd7e6bea0d63cdd8ac8bfe6178d">open_run</a> (self, str run)</td></tr>
<tr class="memdesc:a74e54dd7e6bea0d63cdd8ac8bfe6178d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Open the psana DataSource and time tool detector for the specified run.  <a href="classrawimagetimetool_1_1RawImageTimeTool.html#a74e54dd7e6bea0d63cdd8ac8bfe6178d">More...</a><br /></td></tr>
<tr class="separator:a74e54dd7e6bea0d63cdd8ac8bfe6178d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a53d7ea81d2b9ed868a5748fa317b1ade"><td class="memItemLeft" align="right" valign="top">str&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a53d7ea81d2b9ed868a5748fa317b1ade">get_tt_name</a> (self)</td></tr>
<tr class="memdesc:a53d7ea81d2b9ed868a5748fa317b1ade"><td class="mdescLeft">&#160;</td><td class="mdescRight">Run psana.MPIDataSource.detnames() to get associated detectors, process the output and find the name of the timetool detector.  <a href="classrawimagetimetool_1_1RawImageTimeTool.html#a53d7ea81d2b9ed868a5748fa317b1ade">More...</a><br /></td></tr>
<tr class="separator:a53d7ea81d2b9ed868a5748fa317b1ade"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0a4fc1e14ba23fe38f3828f8d2fd78cf"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a0a4fc1e14ba23fe38f3828f8d2fd78cf">calibrate</a> (self, str run, int order=2, bool figs=True)</td></tr>
<tr class="memdesc:a0a4fc1e14ba23fe38f3828f8d2fd78cf"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fit a calibration model to convert delay to time tool jitter correction.  <a href="classrawimagetimetool_1_1RawImageTimeTool.html#a0a4fc1e14ba23fe38f3828f8d2fd78cf">More...</a><br /></td></tr>
<tr class="separator:a0a4fc1e14ba23fe38f3828f8d2fd78cf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a66011097f025ea667ae432e70576feda"><td class="memItemLeft" align="right" valign="top">str&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a66011097f025ea667ae432e70576feda">format_run</a> (self)</td></tr>
<tr class="memdesc:a66011097f025ea667ae432e70576feda"><td class="mdescLeft">&#160;</td><td class="mdescRight">Format the run(s) number for output file names.  <a href="classrawimagetimetool_1_1RawImageTimeTool.html#a66011097f025ea667ae432e70576feda">More...</a><br /></td></tr>
<tr class="separator:a66011097f025ea667ae432e70576feda"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4fdc03a19a37b1a6fff6e42fe3966b0c"><td class="memItemLeft" align="right" valign="top">(np.array, np.array, np.array)&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a4fdc03a19a37b1a6fff6e42fe3966b0c">process_run</a> (self, calib=True)</td></tr>
<tr class="memdesc:a4fdc03a19a37b1a6fff6e42fe3966b0c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Perform edge detection for all images in a run.  <a href="classrawimagetimetool_1_1RawImageTimeTool.html#a4fdc03a19a37b1a6fff6e42fe3966b0c">More...</a><br /></td></tr>
<tr class="separator:a4fdc03a19a37b1a6fff6e42fe3966b0c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5158fe12edae43200ff25dede03e6cc1"><td class="memItemLeft" align="right" valign="top">(float, int, float)&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a5158fe12edae43200ff25dede03e6cc1">detect_edge</a> (self, np.array img, np.array kernel)</td></tr>
<tr class="memdesc:a5158fe12edae43200ff25dede03e6cc1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Detects an edge in an image projection using convolution with a kernel function.  <a href="classrawimagetimetool_1_1RawImageTimeTool.html#a5158fe12edae43200ff25dede03e6cc1">More...</a><br /></td></tr>
<tr class="separator:a5158fe12edae43200ff25dede03e6cc1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7c09e5b074324c9f80b55bac7a1dfeb1"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a7c09e5b074324c9f80b55bac7a1dfeb1">measure_fwhm</a> (self, np.array trace)</td></tr>
<tr class="memdesc:a7c09e5b074324c9f80b55bac7a1dfeb1"><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the full-width half-max of a convolution trace.  <a href="classrawimagetimetool_1_1RawImageTimeTool.html#a7c09e5b074324c9f80b55bac7a1dfeb1">More...</a><br /></td></tr>
<tr class="separator:a7c09e5b074324c9f80b55bac7a1dfeb1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a110d70ad29e09b8d9c9528f6d000701a"><td class="memItemLeft" align="right" valign="top">np.array&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a110d70ad29e09b8d9c9528f6d000701a">crop_image</a> (self, np.array img)</td></tr>
<tr class="memdesc:a110d70ad29e09b8d9c9528f6d000701a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Crop image.  <a href="classrawimagetimetool_1_1RawImageTimeTool.html#a110d70ad29e09b8d9c9528f6d000701a">More...</a><br /></td></tr>
<tr class="separator:a110d70ad29e09b8d9c9528f6d000701a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad25a2a248163bcec504853c5efe3d08d"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#ad25a2a248163bcec504853c5efe3d08d">fit_calib</a> (self, np.array <a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a161cee0d9d07061403ea94f969d3057e">delays</a>, np.array <a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a726835140ff569a7d92ea38524625575">edges</a>, np.array ampls, np.array fwhm=None, int order=2, list xroi=[250, 870])</td></tr>
<tr class="memdesc:ad25a2a248163bcec504853c5efe3d08d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fit a polynomial calibration curve to a list of edge pixel positions vs delay.  <a href="classrawimagetimetool_1_1RawImageTimeTool.html#ad25a2a248163bcec504853c5efe3d08d">More...</a><br /></td></tr>
<tr class="separator:ad25a2a248163bcec504853c5efe3d08d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04b3636634ab4f046fa1c3740344d01c"><td class="memItemLeft" align="right" valign="top">str&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a04b3636634ab4f046fa1c3740344d01c">ttstage_code</a> (self, str <a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a1e0305c9da697e5ef1dfed1841b99350">hutch</a>)</td></tr>
<tr class="memdesc:a04b3636634ab4f046fa1c3740344d01c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the correct code for the time tool delay (in ns) for a given experimental hutch.  <a href="classrawimagetimetool_1_1RawImageTimeTool.html#a04b3636634ab4f046fa1c3740344d01c">More...</a><br /></td></tr>
<tr class="separator:a04b3636634ab4f046fa1c3740344d01c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac684670660f60ef641340f55e5636eed"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#ac684670660f60ef641340f55e5636eed">edge_to_time</a> (self, int edge_pos, int dirtime=1)</td></tr>
<tr class="memdesc:ac684670660f60ef641340f55e5636eed"><td class="mdescLeft">&#160;</td><td class="mdescRight">Given an internal model and an edge position, return the time tool jitter correction.  <a href="classrawimagetimetool_1_1RawImageTimeTool.html#ac684670660f60ef641340f55e5636eed">More...</a><br /></td></tr>
<tr class="separator:ac684670660f60ef641340f55e5636eed"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0b3afb0b82a3b6c450631da99df98063"><td class="memItemLeft" align="right" valign="top">float&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a0b3afb0b82a3b6c450631da99df98063">actual_time_ps</a> (self, int edge_pos, float nominal_delay)</td></tr>
<tr class="memdesc:a0b3afb0b82a3b6c450631da99df98063"><td class="mdescLeft">&#160;</td><td class="mdescRight">Return the actual time in picoseconds given a nominal delay and time tool data.  <a href="classrawimagetimetool_1_1RawImageTimeTool.html#a0b3afb0b82a3b6c450631da99df98063">More...</a><br /></td></tr>
<tr class="separator:a0b3afb0b82a3b6c450631da99df98063"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a60ee6f9147a421a7de0fd404f81c089a"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a60ee6f9147a421a7de0fd404f81c089a">timetool_correct</a> (self, str run, float nominal, <a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#aece9b35f0af7a2450d47ca5a53ab75f1">model</a>=None, bool figs=True)</td></tr>
<tr class="memdesc:a60ee6f9147a421a7de0fd404f81c089a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Correct a run or set of runs at a given nominal delay for arrival time jitter.  <a href="classrawimagetimetool_1_1RawImageTimeTool.html#a60ee6f9147a421a7de0fd404f81c089a">More...</a><br /></td></tr>
<tr class="separator:a60ee6f9147a421a7de0fd404f81c089a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43e7374a6ad39a7ebb5b13d8de81e042"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a43e7374a6ad39a7ebb5b13d8de81e042">plot_calib</a> (self, list <a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a161cee0d9d07061403ea94f969d3057e">delays</a>, list <a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a726835140ff569a7d92ea38524625575">edges</a>, list <a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#aece9b35f0af7a2450d47ca5a53ab75f1">model</a>)</td></tr>
<tr class="memdesc:a43e7374a6ad39a7ebb5b13d8de81e042"><td class="mdescLeft">&#160;</td><td class="mdescRight">Plot the density of detected edges during a time tool calibration run and the polynomial fit to it.  <a href="classrawimagetimetool_1_1RawImageTimeTool.html#a43e7374a6ad39a7ebb5b13d8de81e042">More...</a><br /></td></tr>
<tr class="separator:a43e7374a6ad39a7ebb5b13d8de81e042"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea2ccf93878ed481daefff81217231c7"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#aea2ccf93878ed481daefff81217231c7">plot_hist</a> (self, list <a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a726835140ff569a7d92ea38524625575">edges</a>)</td></tr>
<tr class="memdesc:aea2ccf93878ed481daefff81217231c7"><td class="mdescLeft">&#160;</td><td class="mdescRight">Plot the density of detected edges in a histogram.  <a href="classrawimagetimetool_1_1RawImageTimeTool.html#aea2ccf93878ed481daefff81217231c7">More...</a><br /></td></tr>
<tr class="separator:aea2ccf93878ed481daefff81217231c7"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a40ac2684a44ffa5a87a20b0512f7896a"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a40ac2684a44ffa5a87a20b0512f7896a">write_file</a> (self, fobj, str fname, str <a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#ace0a81b83a66315ffd591d72261ef13e">savedir</a>, fmt=None)</td></tr>
<tr class="memdesc:a40ac2684a44ffa5a87a20b0512f7896a"><td class="mdescLeft">&#160;</td><td class="mdescRight">Writes objects of multiple types to output files.  <a href="classrawimagetimetool_1_1RawImageTimeTool.html#a40ac2684a44ffa5a87a20b0512f7896a">More...</a><br /></td></tr>
<tr class="separator:a40ac2684a44ffa5a87a20b0512f7896a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1c319795c83fad26ed26a65c3f6f565c"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a1c319795c83fad26ed26a65c3f6f565c">model</a> (self)</td></tr>
<tr class="separator:a1c319795c83fad26ed26a65c3f6f565c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a013b1f0385fa3db66b5e6ea1c829a0aa"><td class="memItemLeft" align="right" valign="top">def&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a013b1f0385fa3db66b5e6ea1c829a0aa">model</a> (self, list val)</td></tr>
<tr class="memdesc:a013b1f0385fa3db66b5e6ea1c829a0aa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set the internal calibration model to coefficients which have been previously fit.  <a href="classrawimagetimetool_1_1RawImageTimeTool.html#a013b1f0385fa3db66b5e6ea1c829a0aa">More...</a><br /></td></tr>
<tr class="separator:a013b1f0385fa3db66b5e6ea1c829a0aa"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:a49603b6ebcdc44e4539f0b9dbb0a997a"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a49603b6ebcdc44e4539f0b9dbb0a997a">expmt</a></td></tr>
<tr class="memdesc:a49603b6ebcdc44e4539f0b9dbb0a997a"><td class="mdescLeft">&#160;</td><td class="mdescRight">(str) Experiment accession name  <a href="classrawimagetimetool_1_1RawImageTimeTool.html#a49603b6ebcdc44e4539f0b9dbb0a997a">More...</a><br /></td></tr>
<tr class="separator:a49603b6ebcdc44e4539f0b9dbb0a997a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1e0305c9da697e5ef1dfed1841b99350"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a1e0305c9da697e5ef1dfed1841b99350">hutch</a></td></tr>
<tr class="memdesc:a1e0305c9da697e5ef1dfed1841b99350"><td class="mdescLeft">&#160;</td><td class="mdescRight">(str) Experimental hutch.  <a href="classrawimagetimetool_1_1RawImageTimeTool.html#a1e0305c9da697e5ef1dfed1841b99350">More...</a><br /></td></tr>
<tr class="separator:a1e0305c9da697e5ef1dfed1841b99350"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ace0a81b83a66315ffd591d72261ef13e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#ace0a81b83a66315ffd591d72261ef13e">savedir</a></td></tr>
<tr class="memdesc:ace0a81b83a66315ffd591d72261ef13e"><td class="mdescLeft">&#160;</td><td class="mdescRight">(str) Directory to save output files to.  <a href="classrawimagetimetool_1_1RawImageTimeTool.html#ace0a81b83a66315ffd591d72261ef13e">More...</a><br /></td></tr>
<tr class="separator:ace0a81b83a66315ffd591d72261ef13e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a93d44077c3f312359208fff0d00ec993"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a93d44077c3f312359208fff0d00ec993">debug</a></td></tr>
<tr class="memdesc:a93d44077c3f312359208fff0d00ec993"><td class="mdescLeft">&#160;</td><td class="mdescRight">(bool) Whether to enable debug features e.g.  <a href="classrawimagetimetool_1_1RawImageTimeTool.html#a93d44077c3f312359208fff0d00ec993">More...</a><br /></td></tr>
<tr class="separator:a93d44077c3f312359208fff0d00ec993"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad7a41f9924a9ec6d40eaa6b962c930b6"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#ad7a41f9924a9ec6d40eaa6b962c930b6">ds</a></td></tr>
<tr class="memdesc:ad7a41f9924a9ec6d40eaa6b962c930b6"><td class="mdescLeft">&#160;</td><td class="mdescRight">(psana.DataSource) DataSource object for accessing data for specified runs.  <a href="classrawimagetimetool_1_1RawImageTimeTool.html#ad7a41f9924a9ec6d40eaa6b962c930b6">More...</a><br /></td></tr>
<tr class="separator:ad7a41f9924a9ec6d40eaa6b962c930b6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1fd1a35886d5cb81f77b7e9f9aa3802d"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a1fd1a35886d5cb81f77b7e9f9aa3802d">det</a></td></tr>
<tr class="memdesc:a1fd1a35886d5cb81f77b7e9f9aa3802d"><td class="mdescLeft">&#160;</td><td class="mdescRight">(psana.Detector) Detector object corresponding to the time tool camera.  <a href="classrawimagetimetool_1_1RawImageTimeTool.html#a1fd1a35886d5cb81f77b7e9f9aa3802d">More...</a><br /></td></tr>
<tr class="separator:a1fd1a35886d5cb81f77b7e9f9aa3802d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a726835140ff569a7d92ea38524625575"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a726835140ff569a7d92ea38524625575">edges</a></td></tr>
<tr class="separator:a726835140ff569a7d92ea38524625575"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a161cee0d9d07061403ea94f969d3057e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a161cee0d9d07061403ea94f969d3057e">delays</a></td></tr>
<tr class="separator:a161cee0d9d07061403ea94f969d3057e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a77753c8dade71d27f3a888c958aa4879"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a77753c8dade71d27f3a888c958aa4879">edges_fit</a></td></tr>
<tr class="separator:a77753c8dade71d27f3a888c958aa4879"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aea916a75f798170cd55ffc380ce4a017"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#aea916a75f798170cd55ffc380ce4a017">delays_fit</a></td></tr>
<tr class="separator:aea916a75f798170cd55ffc380ce4a017"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aece9b35f0af7a2450d47ca5a53ab75f1"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#aece9b35f0af7a2450d47ca5a53ab75f1">model</a></td></tr>
<tr class="separator:aece9b35f0af7a2450d47ca5a53ab75f1"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pri-attribs"></a>
Private Attributes</h2></td></tr>
<tr class="memitem:a17d23e34f5c5a67e1cdf09307e9acf98"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="classrawimagetimetool_1_1RawImageTimeTool.html#a17d23e34f5c5a67e1cdf09307e9acf98">_model</a></td></tr>
<tr class="memdesc:a17d23e34f5c5a67e1cdf09307e9acf98"><td class="mdescLeft">&#160;</td><td class="mdescRight">(list) List of calibration model polynomial coefficients.  <a href="classrawimagetimetool_1_1RawImageTimeTool.html#a17d23e34f5c5a67e1cdf09307e9acf98">More...</a><br /></td></tr>
<tr class="separator:a17d23e34f5c5a67e1cdf09307e9acf98"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Class to reimplement time tool analysis at LCLS from raw images. </p>
<p>Uses psana to interface with experimental data to retrieve raw camera images. Edge detection is implemented in order to perform jitter correction. Refer to the documentation located at <a href="https://lcls-users.readthedocs.org/during/timetool">https://lcls-users.readthedocs.org/during/timetool</a> for information on the theory and usage of this class.</p>
<h2><a class="anchor" id="autotoc_md196"></a>
Properties:</h2>
<p>model - Retrieve or load polynomial model coefficients.</p>
<h2><a class="anchor" id="autotoc_md197"></a>
Methods:</h2>
<p><b>init</b>(self, expmt: str, savedir: str) - Instantiate an analysis object for experiment expmt. open_run(self, run: str) - Open DataSource for a specified run. get_tt_name(self) - Determine time tool camera name in data files. calibrate(self, run: str, order: int, figs=True) - Calibrate the analysis object for jitter correction on specified run. process_run(self) - Perform edge detection on all events in a run. detect_edge(self, img: np.array, kernel: np.array) - Perform edge detection on an image. crop_image(self, img: np.array) - Crop time tool image to ROI. fit_calib(self, delays: np.array, edges: np.array, amplitudes: np.array, fwhm: np.array = None, order: int = 2) - Fit polynomial to calibration run data. ttstage_code(self, hutch) - Return the time tool target time stage for a given hutch.( edge_to_time(self, edge) actual_time_ps(self, edge, nominal) timetool_correct(self, edge, nominal, model, figs=True) plot_calib plot_hist </p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a id="a2c0ba4720efa91c52e10d2f72d46ebad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a2c0ba4720efa91c52e10d2f72d46ebad">&#9670;&nbsp;</a></span>__init__()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def rawimagetimetool.RawImageTimeTool.__init__ </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">str&#160;</td>
          <td class="paramname"><em>expmt</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">str&#160;</td>
          <td class="paramname"><em>savedir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &#160;</td>
          <td class="paramname"><em>debug</em> = <code>False</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initializer for the time tool analysis object. </p>
<pre class="fragment">   @param expmt (str) Experiment accession name. E.g. cxilr1234.
   @param savedir (str) Directory where any output files are saved.
</pre> 
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a id="a0b3afb0b82a3b6c450631da99df98063"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0b3afb0b82a3b6c450631da99df98063">&#9670;&nbsp;</a></span>actual_time_ps()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> float rawimagetimetool.RawImageTimeTool.actual_time_ps </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>edge_pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>nominal_delay</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the actual time in picoseconds given a nominal delay and time tool data. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">edge_pos</td><td>(int) Position (pixel) of detected edge on camera. </td></tr>
    <tr><td class="paramname">nominal_delay</td><td>(float) Nominal delay in picoseconds.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>time (float) Absolute time (ps). Nominal delay corrected for jitter. </dd></dl>

</div>
</div>
<a id="a0a4fc1e14ba23fe38f3828f8d2fd78cf"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0a4fc1e14ba23fe38f3828f8d2fd78cf">&#9670;&nbsp;</a></span>calibrate()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def rawimagetimetool.RawImageTimeTool.calibrate </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">str&#160;</td>
          <td class="paramname"><em>run</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &#160;</td>
          <td class="paramname"><em>order</em> = <code>2</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &#160;</td>
          <td class="paramname"><em>figs</em> = <code>True</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fit a calibration model to convert delay to time tool jitter correction. </p>
<p>MUST be run before analysis if a model has not been previously fit. The fitted polynomial model is saved to a text file for later use.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">run</td><td>(str) SINGLE run number for the experimental calibration run. </td></tr>
    <tr><td class="paramname">order</td><td>(int) Order of the polynomial to fit for calibration. </td></tr>
    <tr><td class="paramname">figs</td><td>(bool) Whether or not to print diagnostic figures. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a110d70ad29e09b8d9c9528f6d000701a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a110d70ad29e09b8d9c9528f6d000701a">&#9670;&nbsp;</a></span>crop_image()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> np.array rawimagetimetool.RawImageTimeTool.crop_image </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">np.array&#160;</td>
          <td class="paramname"><em>img</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Crop image. </p>
<p>Currently done by inspection by specifying a range of rows containing the signal of interest.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">img</td><td>(np.array) 2D time tool camera image.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>cropped (np.array) Cropped image. </dd></dl>

</div>
</div>
<a id="a5158fe12edae43200ff25dede03e6cc1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a5158fe12edae43200ff25dede03e6cc1">&#9670;&nbsp;</a></span>detect_edge()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> (float, int, float) rawimagetimetool.RawImageTimeTool.detect_edge </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">np.array&#160;</td>
          <td class="paramname"><em>img</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">np.array&#160;</td>
          <td class="paramname"><em>kernel</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Detects an edge in an image projection using convolution with a kernel function. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">img</td><td>(array-like) 2D image array. </td></tr>
    <tr><td class="paramname">kernel</td><td>(array-like) 2</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>edge (int) Pixel (column) of the detected edge position. </dd>
<dd>
ampl (float) Convolution amplitude. Can be used for filtering. </dd>
<dd>
fwhm (float) Full-width half-max of convolution. Can be used for filtering. </dd></dl>

</div>
</div>
<a id="ac684670660f60ef641340f55e5636eed"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ac684670660f60ef641340f55e5636eed">&#9670;&nbsp;</a></span>edge_to_time()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> float rawimagetimetool.RawImageTimeTool.edge_to_time </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>edge_pos</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &#160;</td>
          <td class="paramname"><em>dirtime</em> = <code>1</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Given an internal model and an edge position, return the time tool jitter correction. </p>
<p>This method is called by the partner method actual_time_ps; however, it is provided directly so that users who have a different time convention (i.e. negative times when pump arrives before xray) can more easily correct their data.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">edge_pos</td><td>(int | array-like) Position (pixel) of detected edge on camera. </td></tr>
    <tr><td class="paramname">dirtime</td><td>(int) Takes the value of 1 or -1. Use -1 to reverse the direction of time.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>correction (float) Jitter correction in picoseconds. </dd></dl>

</div>
</div>
<a id="ad25a2a248163bcec504853c5efe3d08d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad25a2a248163bcec504853c5efe3d08d">&#9670;&nbsp;</a></span>fit_calib()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def rawimagetimetool.RawImageTimeTool.fit_calib </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">np.array&#160;</td>
          <td class="paramname"><em>delays</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">np.array&#160;</td>
          <td class="paramname"><em>edges</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">np.array&#160;</td>
          <td class="paramname"><em>ampls</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">np.array &#160;</td>
          <td class="paramname"><em>fwhm</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int &#160;</td>
          <td class="paramname"><em>order</em> = <code>2</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">list &#160;</td>
          <td class="paramname"><em>xroi</em> = <code>[250,&#160;870]</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fit a polynomial calibration curve to a list of edge pixel positions vs delay. </p>
<p>In the future this will implement edge acceptance/rejection to improve the calibration. Currently only fits within a certain x pixel range of the camera.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">delays</td><td>(list) List of TT target times (in ns) used for calibration. </td></tr>
    <tr><td class="paramname">edges</td><td>(list) List of corresponding detected edge positions on camera. </td></tr>
    <tr><td class="paramname">ampls</td><td>(list) Convolution amplitudes used for edge rejection. </td></tr>
    <tr><td class="paramname">fwhms</td><td>(list) Full-width half-max of convolution used for edge rejection. </td></tr>
    <tr><td class="paramname">order</td><td>(int) Order of polynomial to fit. </td></tr>
    <tr><td class="paramname">xroi</td><td>(list-like) X-window to consider for fitting. [Min X pixel, Max X pixel] </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a66011097f025ea667ae432e70576feda"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a66011097f025ea667ae432e70576feda">&#9670;&nbsp;</a></span>format_run()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> str rawimagetimetool.RawImageTimeTool.format_run </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Format the run(s) number for output file names. </p>
<p>The format is r0000 for a single run and r0000-r0000 for a range of runs. </p>

</div>
</div>
<a id="a53d7ea81d2b9ed868a5748fa317b1ade"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a53d7ea81d2b9ed868a5748fa317b1ade">&#9670;&nbsp;</a></span>get_tt_name()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> str rawimagetimetool.RawImageTimeTool.get_tt_name </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Run psana.MPIDataSource.detnames() to get associated detectors, process the output and find the name of the timetool detector. </p>
<dl class="section return"><dt>Returns</dt><dd>detname (str) Name of the timetool detector (full or alias). </dd></dl>

</div>
</div>
<a id="a7c09e5b074324c9f80b55bac7a1dfeb1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a7c09e5b074324c9f80b55bac7a1dfeb1">&#9670;&nbsp;</a></span>measure_fwhm()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> float rawimagetimetool.RawImageTimeTool.measure_fwhm </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">np.array&#160;</td>
          <td class="paramname"><em>trace</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Calculate the full-width half-max of a convolution trace. </p>
<pre class="fragment">   @param trace (array-like) Convolution of image projection with Heaviside function.

   @return fwhm (float) Full-width half-max of signal in pixel space.
</pre> 
</div>
</div>
<a id="a1c319795c83fad26ed26a65c3f6f565c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1c319795c83fad26ed26a65c3f6f565c">&#9670;&nbsp;</a></span>model() <span class="overload">[1/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def rawimagetimetool.RawImageTimeTool.model </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a013b1f0385fa3db66b5e6ea1c829a0aa"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a013b1f0385fa3db66b5e6ea1c829a0aa">&#9670;&nbsp;</a></span>model() <span class="overload">[2/2]</span></h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def rawimagetimetool.RawImageTimeTool.model </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">list&#160;</td>
          <td class="paramname"><em>val</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set the internal calibration model to coefficients which have been previously fit. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">val</td><td>(list | str) List of polynomial coefficients in descending order, or file containing them. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a74e54dd7e6bea0d63cdd8ac8bfe6178d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a74e54dd7e6bea0d63cdd8ac8bfe6178d">&#9670;&nbsp;</a></span>open_run()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def rawimagetimetool.RawImageTimeTool.open_run </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">str&#160;</td>
          <td class="paramname"><em>run</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Open the psana DataSource and time tool detector for the specified run. </p>
<p>This method MUST be called before calibration, analysis etc. The psana DataSource and Detector objects are stored in instance variables</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">run</td><td>(str) Run number (e.g. 5) or range of runs (e.g. 6-19). </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a43e7374a6ad39a7ebb5b13d8de81e042"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a43e7374a6ad39a7ebb5b13d8de81e042">&#9670;&nbsp;</a></span>plot_calib()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def rawimagetimetool.RawImageTimeTool.plot_calib </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">list&#160;</td>
          <td class="paramname"><em>delays</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">list&#160;</td>
          <td class="paramname"><em>edges</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">list&#160;</td>
          <td class="paramname"><em>model</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Plot the density of detected edges during a time tool calibration run and the polynomial fit to it. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">delays</td><td>(array-like) Time tool delays in nanoseconds. </td></tr>
    <tr><td class="paramname">edges</td><td>(array-like) Detected edges in time tool camera. </td></tr>
    <tr><td class="paramname">model</td><td>(array-like) Polynomial model coefficients. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="aea2ccf93878ed481daefff81217231c7"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aea2ccf93878ed481daefff81217231c7">&#9670;&nbsp;</a></span>plot_hist()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def rawimagetimetool.RawImageTimeTool.plot_hist </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">list&#160;</td>
          <td class="paramname"><em>edges</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Plot the density of detected edges in a histogram. </p>
<p>For calibration runs this should be uniform. For experiment runs this will ideally be quasi-Gaussian.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">edges</td><td>(array-like) Detected edges in time tool camera. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a4fdc03a19a37b1a6fff6e42fe3966b0c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a4fdc03a19a37b1a6fff6e42fe3966b0c">&#9670;&nbsp;</a></span>process_run()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> (np.array, np.array, np.array) rawimagetimetool.RawImageTimeTool.process_run </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>calib</em> = <code>True</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Perform edge detection for all images in a run. </p>
<pre class="fragment">   @param calib (bool) Whether or not this is a calibration run.

   @return delays (np.array) Array of delays used.
   @return edges (np.array) Detected edge position.
   @return ampls (np.array) Convolution amplitudes for the detected edges.
   @return stamps (np.array) Unique event identifier stamps. NOT returned in calibration.
</pre> 
</div>
</div>
<a id="a60ee6f9147a421a7de0fd404f81c089a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a60ee6f9147a421a7de0fd404f81c089a">&#9670;&nbsp;</a></span>timetool_correct()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def rawimagetimetool.RawImageTimeTool.timetool_correct </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">str&#160;</td>
          <td class="paramname"><em>run</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">float&#160;</td>
          <td class="paramname"><em>nominal</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>model</em> = <code>None</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool &#160;</td>
          <td class="paramname"><em>figs</em> = <code>True</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Correct a run or set of runs at a given nominal delay for arrival time jitter. </p>
<p>Outputs correct time stamps for later binning. Events are identified using their time and fiducial. The output text file has one event per line in the format (seconds-nanoseconds-fiducial tt_correction).</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">run</td><td>(str) Run(s) to correct with timetool. Single string, e.g. '17' or range '16-20'. </td></tr>
    <tr><td class="paramname">nominal</td><td>(float) Nominal time being corrected for in ps. E.g. .5 (500 fs) </td></tr>
    <tr><td class="paramname">model</td><td>(None | str | array-like) Polynomial coefficients of the timetool calibration model. </td></tr>
    <tr><td class="paramname">figs</td><td>(bool) Whether or not to produce diagnostic figures. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<a id="a04b3636634ab4f046fa1c3740344d01c"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a04b3636634ab4f046fa1c3740344d01c">&#9670;&nbsp;</a></span>ttstage_code()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"> str rawimagetimetool.RawImageTimeTool.ttstage_code </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">str&#160;</td>
          <td class="paramname"><em>hutch</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Return the correct code for the time tool delay (in ns) for a given experimental hutch. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">hutch</td><td>(str) Three letter hutch name. E.g. mfx, cxi, xpp</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>code (str) Epics code for accessing hutches time tool delay. </dd></dl>

</div>
</div>
<a id="a40ac2684a44ffa5a87a20b0512f7896a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a40ac2684a44ffa5a87a20b0512f7896a">&#9670;&nbsp;</a></span>write_file()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">def rawimagetimetool.RawImageTimeTool.write_file </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>self</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fobj</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">str&#160;</td>
          <td class="paramname"><em>fname</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">str&#160;</td>
          <td class="paramname"><em>savedir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>fmt</em> = <code>None</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Writes objects of multiple types to output files. </p>
<p>Checks if the save directory exists, if not it creates it.</p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fobj</td><td>(plt.Figure | np.array) Object to write to disk. Can be a figure or array. </td></tr>
    <tr><td class="paramname">fname</td><td>(str) Output filename. </td></tr>
    <tr><td class="paramname">savedir</td><td>(str) Save directory. </td></tr>
  </table>
  </dd>
</dl>

</div>
</div>
<h2 class="groupheader">Member Data Documentation</h2>
<a id="a17d23e34f5c5a67e1cdf09307e9acf98"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a17d23e34f5c5a67e1cdf09307e9acf98">&#9670;&nbsp;</a></span>_model</h2>

<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">rawimagetimetool.RawImageTimeTool._model</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">private</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>(list) List of calibration model polynomial coefficients. </p>
<p>Empty if not calibrated. </p>

</div>
</div>
<a id="a93d44077c3f312359208fff0d00ec993"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a93d44077c3f312359208fff0d00ec993">&#9670;&nbsp;</a></span>debug</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rawimagetimetool.RawImageTimeTool.debug</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>(bool) Whether to enable debug features e.g. </p>
<p>early processing break. </p>

</div>
</div>
<a id="a161cee0d9d07061403ea94f969d3057e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a161cee0d9d07061403ea94f969d3057e">&#9670;&nbsp;</a></span>delays</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rawimagetimetool.RawImageTimeTool.delays</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="aea916a75f798170cd55ffc380ce4a017"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aea916a75f798170cd55ffc380ce4a017">&#9670;&nbsp;</a></span>delays_fit</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rawimagetimetool.RawImageTimeTool.delays_fit</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a1fd1a35886d5cb81f77b7e9f9aa3802d"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1fd1a35886d5cb81f77b7e9f9aa3802d">&#9670;&nbsp;</a></span>det</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rawimagetimetool.RawImageTimeTool.det</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>(psana.Detector) Detector object corresponding to the time tool camera. </p>

</div>
</div>
<a id="ad7a41f9924a9ec6d40eaa6b962c930b6"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ad7a41f9924a9ec6d40eaa6b962c930b6">&#9670;&nbsp;</a></span>ds</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rawimagetimetool.RawImageTimeTool.ds</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>(psana.DataSource) DataSource object for accessing data for specified runs. </p>

</div>
</div>
<a id="a726835140ff569a7d92ea38524625575"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a726835140ff569a7d92ea38524625575">&#9670;&nbsp;</a></span>edges</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rawimagetimetool.RawImageTimeTool.edges</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a77753c8dade71d27f3a888c958aa4879"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a77753c8dade71d27f3a888c958aa4879">&#9670;&nbsp;</a></span>edges_fit</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rawimagetimetool.RawImageTimeTool.edges_fit</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="a49603b6ebcdc44e4539f0b9dbb0a997a"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a49603b6ebcdc44e4539f0b9dbb0a997a">&#9670;&nbsp;</a></span>expmt</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rawimagetimetool.RawImageTimeTool.expmt</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>(str) Experiment accession name </p>

</div>
</div>
<a id="a1e0305c9da697e5ef1dfed1841b99350"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a1e0305c9da697e5ef1dfed1841b99350">&#9670;&nbsp;</a></span>hutch</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rawimagetimetool.RawImageTimeTool.hutch</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>(str) Experimental hutch. </p>
<p>Extracted from expmt. Needed for camera/stage accession. </p>

</div>
</div>
<a id="aece9b35f0af7a2450d47ca5a53ab75f1"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aece9b35f0af7a2450d47ca5a53ab75f1">&#9670;&nbsp;</a></span>model</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rawimagetimetool.RawImageTimeTool.model</td>
        </tr>
      </table>
</div><div class="memdoc">

</div>
</div>
<a id="ace0a81b83a66315ffd591d72261ef13e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#ace0a81b83a66315ffd591d72261ef13e">&#9670;&nbsp;</a></span>savedir</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">rawimagetimetool.RawImageTimeTool.savedir</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>(str) Directory to save output files to. </p>
<p>Figures may be placed in a subdirectory of this one. </p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>btx/processing/<a class="el" href="rawimagetimetool_8py.html">rawimagetimetool.py</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Fri Nov 17 2023 17:00:33 for btx by&#160;<a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.1
</small></address>
</body>
</html>
